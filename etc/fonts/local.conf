<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<!-- /etc/fonts/local.conf file for local customizations -->
<fontconfig>
	<!--
		Overall Settings
	-->
	<match target="font">
		<!--
		Hinting related
		Based on ftview, it seems there are only four visually different legal combinations:
		* Normal (grayscale?) autohint (full?)
		* RGB-subpixel autohints (various geometry; one correct choice for each monitor)
		* Light autohint (slight?)
		* Normal (grayscale?) native hinter, rgba (various geometry) native hinter
		  (Can't tell the difference; native hinters probably always use grayscale.)
		Note: hintstyle is only for autohint!

		Two native hinters are compiled in by default: BCI for TTF, CFF for OTF.
		They are used when autohint=false and hintstyle=full.

		* Prefer BCI, but force some fonts to use (light) autohint.
		* Always use CFF hinting when available.
		* When autohint is used, prefer full LCD autohint (rgb).
		  Native hinters look the same under grayscale or rgb, so we simply always use rgb.

		P.S. Regarding GNOME overriding, it seems the one with lower hintstyle wins. Thus use "full" in GNOME to allow override at here.
		-->
		<!-- Turn on hinting -->
		<edit name="hinting">
			<bool>true</bool>
		</edit>
		<!-- Turn on antialias -->
		<edit name="antialias">
			<bool>true</bool>
		</edit>
		<!-- Subpixel antialiasing -->
		<edit name="rgba">
			<const>rgb</const>
		</edit>
		<!-- LCD filter to work with subpixel -->
		<edit name="lcdfilter">
			<const>lcddefault</const>
		</edit>
		<!-- Default to full hint -->
		<edit name="hintstyle">
			<const>hintfull</const>
		</edit>
		<!-- Don't explicitly set autohint so that the default fallback mechanism is used.
		     i.e. prefer native hinters, but fall back to autohint. -->
	</match>

	<!--
		General Tweaks for Font Appearance
	-->
	<!-- Use hintslight for bold characters -->
	<match target="font">
		<test name="weight" compare="more">
			<const>medium</const>
		</test>
		<edit name="hintstyle">
			<const>hintslight</const>
		</edit>
	</match>
	<!-- Fix CJK global advance -->
	<match target="font">
		<test target="pattern" name="lang" compare="contains">
			<string>zh</string>
		</test>
		<edit name="spacing">
			<const>proportional</const>
		</edit>
		<edit name="globaladvance">
			<bool>false</bool>
		</edit>
	</match>
	<match target="font">
		<test target="pattern" name="lang" compare="contains">
			<string>ja</string>
		</test>
		<edit name="spacing">
			<const>proportional</const>
		</edit>
		<edit name="globaladvance">
			<bool>false</bool>
		</edit>
	</match>
	<match target="font">
		<test target="pattern" name="lang" compare="contains">
			<string>ko</string>
		</test>
		<edit name="spacing">
			<const>proportional</const>
		</edit>
		<edit name="globaladvance">
			<bool>false</bool>
		</edit>
	</match>

	<!--
		Specific Tweaks for Some Fonts
	-->
	<!-- autohint/hintstyle tweaks for certain Linux fonts -->
	<!-- Some fonts that only look good under slight autohint -->
	<match target="font">
		<test name="family" compare="contains">
			<string>DejaVu</string>
		</test>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
		<edit name="hintstyle">
			<const>hintslight</const>
		</edit>
	</match>
	<match target="font">
		<test name="family" compare="contains">
			<string>Bitstream</string>
		</test>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
		<edit name="hintstyle">
			<const>hintslight</const>
		</edit>
	</match>
	<match target="font">
		<test name="family" compare="contains">
			<string>Droid</string>
		</test>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
		<edit name="hintstyle">
			<const>hintslight</const>
		</edit>
	</match>
	<match target="font">
		<test name="family" compare="contains">
			<string>URW</string>
		</test>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
		<edit name="hintstyle">
			<const>hintslight</const>
		</edit>
	</match>
	<!-- Disable autohint for Adobe CFF fonts -->
	<match target="font">
		<test name="fontformat">
			<string>CFF</string>
		</test>
		<edit name="autohint">
			<bool>false</bool>
		</edit>
		<edit name="hintstyle">
			<const>hintfull</const>
		</edit>
	</match>
	<!-- Force autohint for MS core fonts -->
	<match target="font">
		<test name="foundry" compare="contains">
			<string>microsoft</string>
		</test>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
	</match>
	<match target="font">
		<test name="foundry" compare="contains">
			<string>monotype</string>
		</test>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
	</match>
	<match target="font">
		<test name="family" compare="contains">
			<string>SimSun</string>
		</test>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
	</match>
	<!-- Disable antialias for some small fonts (e.g. embedded bitmap available) -->
	<match target="font">
		<test name="family" compare="contains">
			<string>SimSun</string>
		</test>
		<test compare="less" name="pixelsize">
			<double>18</double>
		</test>
		<edit name="antialias">
			<bool>false</bool>
		</edit>
	</match>
	<!-- Disable embedded bitmap and force normal (grayscale) autohint for AR PL UMing -->
	<match target="font">
		<test name="family" compare="contains">
			<string>AR PL UMing</string>
		</test>
		<edit name="embeddedbitmap">
			<bool>false</bool>
		</edit>
		<edit name="autohint">
			<bool>true</bool>
		</edit>
		<edit name="rgba">
			<const>none</const>
		</edit>
	</match>

	<!--
		Rules Matching against Pattern
	-->
	<!-- Replace some ugly/missing chinese fonts -->
	<match target="pattern">
		<test name="family">
			<string>AR PL ShanHeiSun Uni</string>
		</test>
		<edit name="family" binding="same">
			<string>WenQuanYi Bitmap Song</string>
		</edit>
	</match>
	<!-- Replace 'fixed' with 'monospace' -->
	<match target="pattern">
		<test name="family">
			<string>fixed</string>
		</test>
		<edit name="family" binding="same">
			<string>monospace</string>
		</edit>
	</match>
	<!-- Font Preference -->
	<!-- created by WenQuanYi FcDesigner v0.5 -->
	<match target="pattern">
		<test name="family"><string>sans-serif</string></test>
		<edit name="family" mode="prepend" binding="strong">
			<string>Source Sans Pro</string>
			<string>Droid Sans</string>
			<string>DejaVu Sans</string>
			<string>Source Han Sans CN</string>
			<string>Source Han Sans TWHK</string>
			<string>Source Han Sans JP</string>
			<string>Source Han Sans KR</string>
			<string>WenQuanYi Micro Hei</string>
			<string>WenQuanYi Zen Hei</string>
		</edit>
	</match>
	<match target="pattern">
		<test name="family"><string>serif</string></test>
		<edit name="family" mode="prepend" binding="strong">
			<string>Source Serif Pro</string>
			<string>Droid Serif</string>
			<string>DejaVu Serif</string>
			<string>AR PL New Sung</string>
			<string>AR PL UMing CN</string>
			<string>AR PL UMing TW</string>
			<string>WenQuanYi Bitmap Song</string>
		</edit>
	</match>
	<match target="pattern">
		<test name="family"><string>monospace</string></test>
		<edit name="family" mode="prepend" binding="strong">
			<string>DejaVu Sans Mono</string>
			<string>Droid Sans Mono</string>
			<string>Source Code Pro</string>
			<string>WenQuanYi Micro Hei Mono</string>
			<string>WenQuanYi Zen Hei Mono</string>
		</edit>
	</match>
</fontconfig>
